function googleOnLoadCallback(){angular.bootstrap(document,["sanityApp"])}(function(){function a(){var b=this;this.clientId="950592637430.apps.googleusercontent.com",this.apiKey="AIzaSyCs378KoxX1cX5_TTa5W65tTG396AkId0A",this.scopes="https://www.googleapis.com/auth/youtube",this.gapi=gapi,this.q={},this.connect=function(){var a=b.q.defer();return this.gapi.auth.authorize({client_id:this.clientId,scope:this.scopes,immediate:!1},function(c){c&&!c.error?b.gapi.client.load("youtube","v3",function(b){a.resolve(b)}):a.reject()}),a.promise},this.checkAuth=function(){return this.connect()},this.authorize=function(){return this.connect()},this.load=function(){this.gapi.load(),this.gapi.client.setApiKey(this.apiKey)},this.$get=["$q",function(b){var c=new a;return c.q=b,c}]}angular.module("googleAPI",[]),angular.module("googleAPI").provider("googleApi",a)})(),function(){function a(a,b){var c=this;this.get=function(c,d){var e=a.defer();b.gapi.client.setApiKey(b.apiKey);if(typeof b.gapi.client.youtube!="undefined"){var f=b.gapi.client.youtube[c].list(d);b.gapi.client.youtube[c].list(d).execute(function(a){e.resolve(a)})}else e.reject();return e.promise},this.subscriptions=function(a){var b={part:"snippet",mine:!0,maxResults:50};return typeof a!="undefined"&&a!==null&&(b.page=a),c.get("subscriptions",b)},this.channels=function(a){var b={part:"snippet",mine:!0,maxResults:50};return typeof a!="undefined"&&a!==null&&(b.page=a),c.get("channels",b)},this.channelvideos=function(a){return c.get("activities",{part:"contentDetails",channelId:a,maxResults:20})},this.videos=function(a){return c.get("videos",{part:"snippet,contentDetails,status,statistics",mine:!0,id:a.join()})}}angular.module("youtube",[]),a.$inject=["$q","googleApi"],angular.module("youtube").service("ytData",a)}(),function(){function a(a,b,c,d,e,f,g){b.channels=[],b.channelids=[],b.videos=[],b.videoids=[],b.archive=[],b.archiveids=[],b.trash=[],b.trashids=[],a.userid="";var h=[],j=function(){a.settings.sidebar=!1,f.loading(),k().then(function(b){a.userid=b,s().then(function(){l().then(function(a){f.ready()})})},function(){e.go("ready")})},k=function(a){var b=c.defer();return typeof a=="undefined"&&(a=null),g.channels().then(function(a){h.push({id:a.items[0].id,title:a.items[0].snippet.title}),b.resolve(a.items[0].id)},function(){b.reject()}),b.promise},l=function(){var a=c.defer(),d=0,e=b.channels.length-1;for(var f=0;f<b.channels.length;f++)m(b.channels[f].channelId).then(function(b){d+=b,f===e&&a.resolve(d)}(f));return a.promise},m=function(a){var b=c.defer();return g.channelvideos(a).then(function(a){n(a.items).then(function(a){b.resolve(a)})}),b.promise},n=function(a){var b=c.defer();return typeof a!="undefined"?o(a).then(function(a){p(a).then(function(a){b.resolve(a)})}):b.reject(),b.promise},o=function(a){var b=c.defer(),d=[],e=a.length-1;for(var f=0;f<a.length;f++){if(typeof a[f].contentDetails=="undefined")continue;typeof a[f].contentDetails.upload!="undefined"?(d.push(a[f].contentDetails.upload.videoId),f===e&&b.resolve(d)):f===e&&b.resolve(d)}return b.promise},p=function(a){var b=c.defer();return g.videos(a).then(function(a){if(typeof a.items!="undefined"){var c=a.items.length-1,d=0;for(var e=0;e<a.items.length;e++)q(a.items[e])&&d++,e===c&&b.resolve(d)}else b.resolve(0)}),b.promise},q=function(c){var d={id:c.id,link:"https://www.youtube.com/watch?v="+c.id,title:c.snippet.title,thumbnail:{"default":c.snippet.thumbnails.default.url,medium:c.snippet.thumbnails.medium.url,high:c.snippet.thumbnails.high.url},channelId:c.snippet.channelId,author:c.snippet.channelTitle,authorlink:"https://www.youtube.com/channel/"+c.snippet.channelId,published:c.snippet.publishedAt,duration:c.contentDetails.duration},e=$.inArray(c.id,b.videoids);if(e!=-1)return null;var f=!1;return a.filters.channels.hasOwnProperty(d.channelId)&&$.each(a.filters.channels[c.channelId].filters,function(a,b){c.title.indexOf(b.string)!=-1&&(f=!0)}),f&&a.filters.caught++,f?(b.trash.push(d),b.trashids.push(d.id)):(b.videos.push(d),b.videoids.push(d.id)),!0},r=function(){var a=b.videos.length;for(i=0;i<a;i++)typeof b.videos[i].hash=="undefined"&&(b.videos[i].hash=b.videos[i].id),typeof b.videos[i].$$hashKey!="undefined"&&delete b.videos[i].$$hashKey,b.videos[i].id=i,typeof b.videos[i].watched=="undefined"&&(b.videos[i].watched=b.videos[i].muted,b.videos[i].muted=!1)},s=function(a){var b=c.defer();return typeof a=="undefined"&&(a=null),g.subscriptions(a).then(function(c){t(c,a).then(function(){b.resolve()})}),b.promise},t=function(a,d){var e=c.defer();return typeof d=="undefined"&&(d=""),typeof a.items!="undefined"?u(a.items).then(function(){b.channels.length<a.pageInfo.totalResults&&a.nextPageToken!=d?s(a.nextPageToken).then(function(){e.resolve()}):e.resolve()}):e.resolve(),e.promise},u=function(a){var d=c.defer(),e=a.length-1;for(var f=0;f<a.length;f++)$.inArray(a[f].id,b.channelids)==-1&&(b.channels.push({id:a[f].id,title:a[f].snippet.title,description:a[f].snippet.description,channelId:a[f].snippet.resourceId.channelId}),b.channelids.push(a[f].id)),f===e&&d.resolve();return d.promise},v=function(){f.loading(),a.filters.caught=0,l()},w=function(){a.settings.sidebar===!0?$(".sidebar").css({height:d.height()}):$(".sidebar").css({height:"40px"})},x=function(){};b.refresh=function(){f.loading(),f.update(),v()},b.hideChannel=function(b){var c=$.inArray(b,a.channeloptions.hidden);c!=-1?a.channeloptions.hidden=a.channeloptions.hidden.splice(c,1):a.channeloptions.hidden.push(b)},b.togglesidebar=function(){a.settings.sidebar=!a.settings.sidebar,w()},b.videoFilter=function(b){if(a.channelstate.hidden[b.channelId]==="1")return null;var c=!1;return $.each(a.filters.global,function(a,d){b.title.indexOf(d.string)!=-1&&(c=!0)}),b},b.setLimit=function(b){a.settings.videolimit=Number(a.settings.videolimit)+Number(b),a.settings.videolimit<1&&(a.settings.videolimit=5)};var y=function(){a.settings.videolimit<b.videos.length?(b.percentage=parseInt(100*a.settings.videolimit/b.videos.length),b.abslength=a.settings.videolimit):(b.percentage=100,b.abslength=b.videos.length)};b.$watch("videos",y,!0),b.$watch("settings",y,!0),b.percentage=y(),angular.element(d).bind("keyup",function(a){a.which===82&&b.refresh()}),j(),w()}angular.module("sanityData",["youtube"]),a.$inject=["$rootScope","$scope","$q","$document","$state","sanityApp","ytData"],angular.module("sanityData").controller("AppRepeatCtrl",a)}(),function(){function a(a,b,c){c.config({name:"SanityGrid",version:1,storeName:"default",description:"The grid for people who like to stay sane"}),a.otherwise("/ready"),b.state("ready",{url:"/ready",views:{main:{templateUrl:"templates/start.html"}}}).state("list",{url:"/list",views:{main:{templateUrl:"templates/videos.html"},footer:{templateUrl:"templates/footer.html"}}})}function b(a){a.apiReady=!0,$.isEmptyObject(a.settings)&&(a.settings={hidewatched:!1,hidemuted:!0,theme:"default"}),typeof a.videos=="object"&&(a.videos=[]),$.isEmptyObject(a.channelstate)&&(a.channelstate={},a.channelstate.hidden={},a.channelstate.zipped={}),$.isEmptyObject(a.filters)&&(a.filters={},a.filters.count=0,a.filters.caught=0,a.filters.global=[]),typeof a.filters.global=="undefined"&&(a.filters={},a.filters.count=0,a.filters.caught=0,a.filters.global=[],a.filters.channels={}),typeof a.filters.channels=="undefined"&&(a.filters.channels={}),$.isArray(a.videocache)&&(a.videocache={}),typeof a.settings.adblocksecret=="undefined"&&(a.settings.adblocksecret=Math.random().toString(36).substr(2),a.settings.adblockoverride=!1),typeof a.settings.videolimit=="undefined"&&(a.settings.videolimit=100)}function c(a,b,c,d){a.gotimelist=["YEAH BOIIIII!!!","Well, if you say so, I guess...","My body is ready for sanity!","Let's go!"];var e=Math.floor(Math.random()*a.gotimelist.length);a.gotime=a.gotimelist[e],a.selectUserid=function(a){a===!1?c.go("ready"):c.go("list")},a.connect=function(){d.authorize().then(function(){c.go("list")})},b.userid&&(a.start=!1,b.settings.sidebar=!1,d.checkAuth().then(function(){c.go("list")}))}function d(a,b,c,d,e,f,g){a.userid="";var h=function(){a.settings.sidebar=!1,f.loading()},i=function(){f.loading(),a.filters.caught=0},j=function(){a.settings.sidebar===!0?$(".sidebar").css({height:d.height()}):$(".sidebar").css({height:"40px"})};b.refresh=function(){f.loading(),f.update()},b.hideChannel=function(b){var c=$.inArray(b,a.channeloptions.hidden);c!=-1?a.channeloptions.hidden=a.channeloptions.hidden.splice(c,1):a.channeloptions.hidden.push(b)},b.togglesidebar=function(){a.settings.sidebar=!a.settings.sidebar,j()},b.videoFilter=function(b){if(a.channelstate.hidden[b.channelId]==="1")return null;var c=!1;return $.each(a.filters.global,function(a,d){b.title.indexOf(d.string)!=-1&&(c=!0)}),b},b.setLimit=function(b){a.settings.videolimit=Number(a.settings.videolimit)+Number(b),a.settings.videolimit<1&&(a.settings.videolimit=5)};var k=function(){a.settings.videolimit<b.videos.length?(b.percentage=parseInt(100*a.settings.videolimit/b.videos.length),b.abslength=a.settings.videolimit):(b.percentage=100,b.abslength=b.videos.length)};b.$watch("videos",k,!0),b.$watch("settings",k,!0),b.percentage=k(),angular.element(d).bind("keyup",function(a){a.which===82&&b.refresh()}),h(),j()}function e(a,b){b.cancel=function(){b.$hide()},b.redoadblocksecret=function(){a.settings.adblocksecret=Math.random().toString(36).substr(2)},b.removeFilter=function(b,c){b.length?(a.filters.channels[b].filters.splice(c,1),a.filters.channels[b].filters.length===0&&delete a.filters.channels[b]):a.filters.global.splice(c,1),a.filters.count--}}function f(a,b){b.video.authorid?b.filter={title:b.video.title,channel:b.video.authorid,author:b.video.author,authorid:b.video.authorid}:b.filter={title:b.video.title,channel:b.video.author,author:b.video.author,authorid:b.video.author},b.cancel=function(){b.$hide()},b.ok=function(){b.filter.channel.length?(typeof a.filters.channels[b.filter.channel]=="undefined"&&(a.filters.channels[b.filter.channel]={title:b.filter.channel,filters:[]}),a.filters.channels[b.filter.channel].filters.push({string:b.filter.title})):a.filters.global.push({string:b.filter.title}),a.filters.count++,b.$hide()}}function g(a){a.tabs=[],a.navType="pills",a.adblockadvice="firefox",a.adblockswitch=function(b){a.adblockadvice=b}}function h(a){a.oneAtATime=!0}function i(a,b){var c=function(a,b){var c=a.split("."),d=b.split(".");for(var e=0;e<c.length;++e)if(c[e]>d[e])return!0;return!1},d;this.resetErrors=function(){if(b.forbidden==1||b.notfound==1)b.forbidden=0,b.notfound=0},this.appinfo=function(a){var b="info.json";$.getJSON(b).fail(function(b,c,d){a(d,b.status)}).done(function(b){a(b,200)})},this.appupdates=function(a){var b=new Gh3.User("daviddeutsch"),c=new Gh3.Repository("yt-sanegrid",b);c.fetch(function(b,c){b&&a(b,500)}),c.fetchClosedIssues(function(b,d){b&&a(b,500),a(c.getIssues(),200)})},that=this,this.update=function(){that.appinfo(function(a,d){if(!c(a.version,b.info.version))return;b.info.update=a.version,b.info.updates.outdated=!0,b.info.updates.new=0,b.info.updates.title="Fresh Update(s)!",that.appupdates(function(a,c){b.info.updates.list=a,$.each(b.info.updates.list,function(a,c){var d=new Date(c.updated_at);d>b.info.date?(b.info.updates.list[a].new=!0,b.info.updates.new++):b.info.updates.list[a].new=!1})})})},this.appinfo(function(a,c){b.info={version:a.version,updates:{list:[]},date:new Date},that.appupdates(function(a,c){b.info.updates.list=a})}),this.loading=function(){clearTimeout(d),b.status=1},this.ready=function(a){function c(){b.status=0}clearTimeout(d),a=a===null?500:!1,a?d=setTimeout(c,a):c()}}function j(a){var b;return{nowTime:0,initted:!1,settings:{refreshMillis:6e4,allowFuture:!1,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",numbers:[]}},doTimeout:function(){b.nowTime=(new Date).getTime(),a(b.doTimeout,b.settings.refreshMillis)},init:function(){this.initted===!1&&(this.initted=!0,this.nowTime=(new Date).getTime(),b=this,this.doTimeout(),this.initted=!0)},inWords:function(a){function j(c,d){var e=$.isFunction(c)?c(d,a):c,f=b.numbers&&b.numbers[d]||d;return e.replace(/%d/i,f)}var b=this.settings.strings,c=b.prefixAgo,d=b.suffixAgo;this.settings.allowFuture&&a<0&&(c=b.prefixFromNow,d=b.suffixFromNow);var e=Math.abs(a)/1e3,f=e/60,g=f/60,h=g/24,i=h/365,k=e<45&&j(b.seconds,Math.round(e))||e<90&&j(b.minute,1)||f<45&&j(b.minutes,Math.round(f))||f<90&&j(b.hour,1)||g<24&&j(b.hours,Math.round(g))||g<42&&j(b.day,1)||h<30&&j(b.days,Math.round(h))||h<45&&j(b.month,1)||h<365&&j(b.months,Math.round(h/30))||i<1.5&&j(b.year,1)||j(b.years,Math.round(i)),l=b.wordSeparator===undefined?" ":b.wordSeparator;return $.trim([c,k,d].join(l))}}}function k(){return function(a){var b=a.split("M");b[0]=Number(b[0].slice(2)),typeof b[1]=="undefined"?b[1]=0:b[1]=Number(b[1].slice(0,-1));var c=Math.floor(b[0]/60),d=Math.floor(b[0]%60),e=b[1];return(c>0?c+":":"")+(d>0?(c>0&&d<10?"0":"")+d+":":"00:")+(e<10?"0":"")+e}}function l(){return function(a){return(new Date(a)).getTime()}}function m(a){return{restrict:"C",scope:{video:"="},templateUrl:"templates/item.html",controller:function(b,c){b.mute=function(){b.video.muted=!b.video.muted,b.video.muteddate=(new Date).toISOString()},b.watch=function(c){if(c.button==2)return;a(function(){b.watched(!1)},400)},c.settings.adblockoverride?b.link=b.video.link+"&adblock="+c.settings.adblocksecret:b.link=b.video.link,b.watched=function(a){if(b.video.watched&&!a)return;b.video.watched=!b.video.watched,b.video.watcheddate=(new Date).toISOString()}}}}function n(a){return{replace:!0,restrict:"EA",scope:{fromTime:"@"},link:{post:function(b,c,d){b.timeago=a,b.timeago.init(),b.$watch("timeago.nowTime-fromTime",function(a){b.timeago.nowTime!==undefined&&(a=b.timeago.nowTime-b.fromTime,$(c).text(b.timeago.inWords(a)))})}}}}function o(){return function(a,b,c){b.bind("click",function(){this.select()})}}angular.module("sanityApp",["ngAnimate","ui.router","mgcrea.ngStrap","ngSocial","localStorage","LocalForageModule","googleAPI","youtube"]),a.$inject=["$urlRouterProvider","$stateProvider","$localForageProvider"],angular.module("sanityApp").config(a),b.$inject=["$rootScope"],angular.module("sanityApp").run(b),c.$inject=["$scope","$rootScope","$state","googleApi"],angular.module("sanityApp").controller("StartCtrl",c),d.$inject=["$rootScope","$scope","$q","$document","$state","sanityApp","ytData"],angular.module("sanityApp").controller("AppRepeatCtrl",d),e.$inject=["$rootScope","$scope"],angular.module("sanityApp").controller("SettingsModalCtrl",e),f.$inject=["$rootScope","$scope"],angular.module("sanityApp").controller("FilterModalCtrl",f),g.$inject=["$scope"],angular.module("sanityApp").controller("SettingsTabsCtrl",g),h.$inject=["$scope"],angular.module("sanityApp").controller("SettingsAccordionCtrl",h),i.$inject=["$q","$rootScope"],angular.module("sanityApp").service("sanityApp",i),j.$inject=["$timeout"],angular.module("sanityApp").service("timeAgo",j),angular.module("sanityApp").filter("duration",k),angular.module("sanityApp").filter("timestamp",l),m.$inject=["$timeout"],angular.module("sanityApp").directive("videoItem",m),n.$inject=["timeAgo"],angular.module("sanityApp").directive("timeAgo",n),angular.module("sanityApp").directive("selectOnClick",o)}();