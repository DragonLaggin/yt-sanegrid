function googleOnLoadCallback(){angular.bootstrap(document,["sanityApp"])}(function(){function a(){var b=this;this.clientId="950592637430.apps.googleusercontent.com",this.apiKey="AIzaSyCs378KoxX1cX5_TTa5W65tTG396AkId0A",this.scopes="https://www.googleapis.com/auth/youtube",this.gapi=gapi,this.q={},this.connect=function(){var a=b.q.defer();return this.gapi.auth.authorize({client_id:this.clientId,scope:this.scopes,immediate:!1},function(c){c&&!c.error?b.gapi.client.load("youtube","v3",function(b){a.resolve(b)}):a.reject()}),a.promise},this.checkAuth=function(){return this.connect()},this.authorize=function(){return this.connect()},this.load=function(){this.gapi.load(),this.gapi.client.setApiKey(this.apiKey)},this.$get=["$q",function(b){var c=new a;return c.q=b,c}]}angular.module("googleAPI",[]),angular.module("googleAPI").provider("googleApi",a)})(),function(){function a(a,b){var c=this;this.get=function(c,d){var e=a.defer();b.gapi.client.setApiKey(b.apiKey);if(typeof b.gapi.client.youtube!="undefined"){var f=b.gapi.client.youtube[c].list(d);b.gapi.client.youtube[c].list(d).execute(function(a){e.resolve(a)})}else e.reject();return e.promise},this.subscriptions=function(a){var b={part:"snippet",mine:!0,maxResults:50};return typeof a!="undefined"&&a!==null&&(b.page=a),c.get("subscriptions",b)},this.channels=function(a){var b={part:"snippet",mine:!0,maxResults:50};return typeof a!="undefined"&&a!==null&&(b.page=a),c.get("channels",b)},this.channelvideos=function(a){return c.get("activities",{part:"contentDetails",channelId:a,maxResults:20})},this.videos=function(b){var d=a.defer();return c.get("videos",{part:"snippet,contentDetails,status,statistics",mine:!0,id:b.join()}).then(function(a){typeof a.items=="undefined"?d.reject():d.resolve(a.items)},function(){d.reject()}),d.promise}}angular.module("youtube",["googleAPI"]),a.$inject=["$q","googleApi"],angular.module("youtube").service("ytData",a)}(),function(){function a(a,b,c,d,e,f,g,h){return{migrateOldLS:function(){}}}function b(a,b,c,d,e){return{init:function(){var f=b.defer();return c.init().then(function(){a.userid=c.current,e.init(),e.pageChannels().then(function(){d.init(),d.loadVideos().then(function(){f.resolve(d.countLastAdded)})})}),f.promise}}}function c(a,b,c){return{data:c("ytSanityDB/v0/accounts"),current:"",doc:null,init:function(c){var d=a.defer(),e=this;return typeof c=="undefined"&&(c=null),b.channels().then(function(a){e.findAccount(a.items[0].id).then(function(a){e.doc=a,e.current=a.id,d.resolve()},function(){e.data.post({ytId:a.items[0].id,title:a.items[0].snippet.title}).then(function(b){e.data.get(b.id).then(function(a){e.doc=a}),e.current=a.items[0].id,d.resolve()})})},function(){d.reject()}),d.promise},findAccount:function(b){function d(a){a.ytId==b&&emit(a._id,a)}var c=a.defer();return this.data.query({map:d},{reduce:!1}).then(function(a){a.total_rows>0?c.resolve(a.rows[0]):c.reject()}),c.promise}}}function d(a,b,c,d,e,f){return{data:null,countLastAdded:0,init:function(){this.data=d("ytSanityDB/v0/"+e.current+"/videos")},bind:function(b){var c=a.defer();return self.data.allDocs().then(function(a){b.videos=a,c.resolve()}),c.promise},loadVideos:function(){var b=a.defer(),c=[],d=this;return this.countLastAdded=0,f.data.allDocs().then(function(b){angular.forEach(b,function(b){var e=a.defer();c.push(e),d.channelVideos(b.channelId).then(function(){e.resolve()},function(){e.resolve()})})}),a.all(c).then(function(){b.resolve()}),b.promise},channelVideos:function(b){var d=a.defer(),e=this;return c.channelvideos(b).then(function(a){return e.pushVideos(a.items)}).then(function(){d.resolve()},function(){d.reject()}),d.promise},pushVideos:function(b){var c=a.defer(),d=this;return typeof b!="undefined"?d.extractVideoIds(b).then(function(a){return d.pushVideoIds(a)}).then(function(a){c.resolve(a)}):c.reject(),c.promise},extractVideoIds:function(b){var c=a.defer(),d=[],e=b.length-1;for(var f=0;f<b.length;f++){if(typeof b[f].contentDetails=="undefined")continue;typeof b[f].contentDetails.upload!="undefined"?(d.push(b[f].contentDetails.upload.videoId),f===e&&c.resolve(d)):f===e&&c.resolve(d)}return c.promise},pushVideoIds:function(b){var d=a.defer(),e=this;return c.videos(b).then(function(b){var c=[];angular.forEach(b,function(b){var d=a.defer();c.push(d),e.videoExists(b.id).then(function(){d.resolve()},function(){e.pushVideo(b).then(function(){e.countLastAdded++,d.resolve()})})}),a.all(c).then(function(){d.resolve()})},function(){d.resolve(0)}),d.promise},videoExists:function(b){function d(a){a.ytId==b&&emit(a._id,a)}var c=a.defer();return this.data.query({map:d},{reduce:!1}).then(function(a){a.total_rows>0?c.resolve():c.reject()},function(a){alert(a)}),c.promise},pushVideo:function(c){var d=a.defer(),f={ytId:c.id,link:"https://www.youtube.com/watch?v="+c.id,title:c.snippet.title,thumbnail:{"default":c.snippet.thumbnails.default.url,medium:c.snippet.thumbnails.medium.url,high:c.snippet.thumbnails.high.url},channelId:c.snippet.channelId,author:c.snippet.channelTitle,authorlink:"https://www.youtube.com/channel/"+c.snippet.channelId,published:c.snippet.publishedAt,duration:c.contentDetails.duration,archive:!1,trash:!1};return b.filters.channels.hasOwnProperty(f.channelId)&&$.each(b.filters.channels[c.channelId].filters,function(a,d){c.title.indexOf(d.string)!=-1&&(f.trash=!0,b.filters.caught++)}),this.data.create(f).then(function(){e.pushVideoId(f.id),d.resolve()}),d.promise}}}function e(a,b,c,d){return{data:null,init:function(){this.data=c("ytSanityDB/v0/"+d.current+"/channels")},pageChannels:function(c){var d=a.defer(),e=this;return typeof c=="undefined"&&(c=null),b.subscriptions(c).then(function(a){return e.loadChannels(a,c)}).then(function(){d.resolve()}),d.promise},loadChannels:function(b,c){var d=a.defer(),e=this;return typeof c=="undefined"&&(c=""),typeof b.items!="undefined"?e.appendChannels(b.items).then(function(){b.nextPageToken!=c?e.pageChannels(b.nextPageToken).then(function(){d.resolve()}):d.resolve()}):d.resolve(),d.promise},appendChannels:function(b){var c=[],d=this;return angular.forEach(b,function(b){var e=a.defer();c.push(e),d.channelExists(b.id).then(function(){e.resolve()},function(){d.data.post({ytId:b.id,title:b.snippet.title,description:b.snippet.description,channelId:b.snippet.resourceId.channelId}).then(function(){e.resolve()})})}),a.all(c)},channelExists:function(b){function d(a){a.ytId==b&&emit(a._id,a)}var c=a.defer();return this.data.query({map:d},{reduce:!1}).then(function(a){a.total_rows>0?c.resolve():c.reject()},function(a){alert(a)}),c.promise}}}angular.module("sanityData",["youtube","pouchdb"]),a.$inject=["$rootScope","$q","ytData","accounts","videos","channels","archive","trash"],angular.module("sanityData").service("connection",a),b.$inject=["$rootScope","$q","accounts","videos","channels"],angular.module("sanityData").service("data",b),c.$inject=["$q","ytData","pouchDB"],angular.module("sanityData").service("accounts",c),d.$inject=["$q","$rootScope","ytData","pouchDB","accounts","channels"],angular.module("sanityData").service("videos",d),e.$inject=["$q","ytData","pouchDB","accounts"],angular.module("sanityData").service("channels",e)}(),function(){function a(a,b){a.otherwise("/ready"),b.state("ready",{url:"/ready",views:{main:{templateUrl:"templates/start.html"}}}).state("list",{url:"/list",views:{main:{templateUrl:"templates/videos.html"},footer:{templateUrl:"templates/footer.html"}}})}function b(a){a.apiReady=!0,$.isEmptyObject(a.settings)&&(a.settings={hidewatched:!1,hidemuted:!0,theme:"default"}),typeof a.videos=="object"&&(a.videos=[]),$.isEmptyObject(a.channelstate)&&(a.channelstate={},a.channelstate.hidden={},a.channelstate.zipped={}),$.isEmptyObject(a.filters)&&(a.filters={},a.filters.count=0,a.filters.caught=0,a.filters.global=[]),typeof a.filters.global=="undefined"&&(a.filters={},a.filters.count=0,a.filters.caught=0,a.filters.global=[],a.filters.channels={}),typeof a.filters.channels=="undefined"&&(a.filters.channels={}),$.isArray(a.videocache)&&(a.videocache={}),typeof a.settings.adblocksecret=="undefined"&&(a.settings.adblocksecret=Math.random().toString(36).substr(2),a.settings.adblockoverride=!1),typeof a.settings.videolimit=="undefined"&&(a.settings.videolimit=100)}function c(a,b,c,d){a.gotimelist=["YEAH BOIIIII!!!","Well, if you say so, I guess...","My body is ready for sanity!","Let's go!","Jeez, enough with the buttons already"];var e=Math.floor(Math.random()*a.gotimelist.length);a.gotime=a.gotimelist[e],a.startlinelist=["It's substantially more pleasant than a good, hard slap in the face","It almost certainly cannot give you, like, any tangible disease","Just like your extensive YouTube habit, it's totally not at all an unlimited source of self-loathing for its author","Nobody technically forces you to use it, which is cool, I guess"],e=Math.floor(Math.random()*a.startlinelist.length),a.startline=a.startlinelist[e],a.selectUserid=function(a){a===!1?c.go("ready"):c.go("list")},a.connect=function(){d.authorize().then(function(){c.go("list")})},b.userid&&(a.start=!1,b.settings.sidebar=!1,d.checkAuth().then(function(){c.go("list")}))}function d(a,b,c,d,e,f,g){a.userid="";var h=function(){a.settings.sidebar=!1,e.loading(),f.init().then(function(){g.bind(b).then(function(){e.ready()})},function(){c.go("ready")})},i=function(){e.loading(),a.filters.caught=0},j=function(){a.settings.sidebar===!0?$(".sidebar").css({height:d.height()}):$(".sidebar").css({height:"40px"})};b.refresh=function(){e.loading(),e.update()},b.hideChannel=function(b){var c=$.inArray(b,a.channeloptions.hidden);c!=-1?a.channeloptions.hidden=a.channeloptions.hidden.splice(c,1):a.channeloptions.hidden.push(b)},b.togglesidebar=function(){a.settings.sidebar=!a.settings.sidebar,j()},b.videoFilter=function(b){if(a.channelstate.hidden[b.channelId]==="1")return null;var c=!1;return $.each(a.filters.global,function(a,d){b.title.indexOf(d.string)!=-1&&(c=!0)}),b},b.setLimit=function(b){a.settings.videolimit=Number(a.settings.videolimit)+Number(b),a.settings.videolimit<1&&(a.settings.videolimit=5)},b.percentage=0,b.abslength=100,angular.element(d).bind("keyup",function(a){a.which===82&&b.refresh()}),h(),j()}function e(a,b){b.cancel=function(){b.$hide()},b.redoadblocksecret=function(){a.settings.adblocksecret=Math.random().toString(36).substr(2)},b.removeFilter=function(b,c){b.length?(a.filters.channels[b].filters.splice(c,1),a.filters.channels[b].filters.length===0&&delete a.filters.channels[b]):a.filters.global.splice(c,1),a.filters.count--}}function f(a,b){b.video.authorid?b.filter={title:b.video.title,channel:b.video.authorid,author:b.video.author,authorid:b.video.authorid}:b.filter={title:b.video.title,channel:b.video.author,author:b.video.author,authorid:b.video.author},b.cancel=function(){b.$hide()},b.ok=function(){b.filter.channel.length?(typeof a.filters.channels[b.filter.channel]=="undefined"&&(a.filters.channels[b.filter.channel]={title:b.filter.channel,filters:[]}),a.filters.channels[b.filter.channel].filters.push({string:b.filter.title})):a.filters.global.push({string:b.filter.title}),a.filters.count++,b.$hide()}}function g(a){a.tabs=[],a.navType="pills",a.adblockadvice="firefox",a.adblockswitch=function(b){a.adblockadvice=b}}function h(a){a.oneAtATime=!0}function i(a,b){var c=function(a,b){var c=a.split("."),d=b.split(".");for(var e=0;e<c.length;++e)if(c[e]>d[e])return!0;return!1},d;this.resetErrors=function(){if(b.forbidden==1||b.notfound==1)b.forbidden=0,b.notfound=0},this.appinfo=function(a){var b="info.json";$.getJSON(b).fail(function(b,c,d){a(d,b.status)}).done(function(b){a(b,200)})},this.appupdates=function(a){var b=new Gh3.User("daviddeutsch"),c=new Gh3.Repository("yt-sanegrid",b);c.fetch(function(b,c){b&&a(b,500)}),c.fetchClosedIssues(function(b,d){b&&a(b,500),a(c.getIssues(),200)})},that=this,this.update=function(){that.appinfo(function(a,d){if(!c(a.version,b.info.version))return;b.info.update=a.version,b.info.updates.outdated=!0,b.info.updates.new=0,b.info.updates.title="Fresh Update(s)!",that.appupdates(function(a,c){b.info.updates.list=a,$.each(b.info.updates.list,function(a,c){var d=new Date(c.updated_at);d>b.info.date?(b.info.updates.list[a].new=!0,b.info.updates.new++):b.info.updates.list[a].new=!1})})})},this.appinfo(function(a,c){b.info={version:a.version,updates:{list:[]},date:new Date},that.appupdates(function(a,c){b.info.updates.list=a})}),this.loading=function(){clearTimeout(d),b.status=1},this.ready=function(a){function c(){b.status=0}clearTimeout(d),a=a===null?500:!1,a?d=setTimeout(c,a):c()}}function j(a){var b;return{nowTime:0,initted:!1,settings:{refreshMillis:6e4,allowFuture:!1,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",numbers:[]}},doTimeout:function(){b.nowTime=(new Date).getTime(),a(b.doTimeout,b.settings.refreshMillis)},init:function(){this.initted===!1&&(this.initted=!0,this.nowTime=(new Date).getTime(),b=this,this.doTimeout(),this.initted=!0)},inWords:function(a){function j(c,d){var e=$.isFunction(c)?c(d,a):c,f=b.numbers&&b.numbers[d]||d;return e.replace(/%d/i,f)}var b=this.settings.strings,c=b.prefixAgo,d=b.suffixAgo;this.settings.allowFuture&&a<0&&(c=b.prefixFromNow,d=b.suffixFromNow);var e=Math.abs(a)/1e3,f=e/60,g=f/60,h=g/24,i=h/365,k=e<45&&j(b.seconds,Math.round(e))||e<90&&j(b.minute,1)||f<45&&j(b.minutes,Math.round(f))||f<90&&j(b.hour,1)||g<24&&j(b.hours,Math.round(g))||g<42&&j(b.day,1)||h<30&&j(b.days,Math.round(h))||h<45&&j(b.month,1)||h<365&&j(b.months,Math.round(h/30))||i<1.5&&j(b.year,1)||j(b.years,Math.round(i)),l=b.wordSeparator===undefined?" ":b.wordSeparator;return $.trim([c,k,d].join(l))}}}function k(){return function(a){var b=a.split("M");b[0]=Number(b[0].slice(2)),typeof b[1]=="undefined"?b[1]=0:b[1]=Number(b[1].slice(0,-1));var c=Math.floor(b[0]/60),d=Math.floor(b[0]%60),e=b[1];return(c>0?c+":":"")+(d>0?(c>0&&d<10?"0":"")+d+":":"00:")+(e<10?"0":"")+e}}function l(){return function(a){return(new Date(a)).getTime()}}function m(a,b){return{restrict:"C",scope:{video:"="},templateUrl:"templates/item.html",controller:function(c,d){c.mute=function(){c.video.muted=!c.video.muted,c.video.muteddate=(new Date).toISOString(),b.data.update(c.video)},c.watch=function(b){if(b.button==2)return;a(function(){c.watched(!1)},400)},c.watched=function(a){if(c.video.watched&&!a)return;c.video.watched=!c.video.watched,c.video.watcheddate=(new Date).toISOString(),b.data.update(c.video)},d.settings.adblockoverride?c.link=c.video.link+"&adblock="+d.settings.adblocksecret:c.link=c.video.link}}}function n(a){return{replace:!0,restrict:"EA",scope:{fromTime:"@"},link:{post:function(b,c,d){b.timeago=a,b.timeago.init(),b.$watch("timeago.nowTime-fromTime",function(a){b.timeago.nowTime!==undefined&&(a=b.timeago.nowTime-b.fromTime,$(c).text(b.timeago.inWords(a)))})}}}}function o(){return function(a,b,c){b.bind("click",function(){this.select()})}}angular.module("sanityApp",["ngAnimate","ui.router","mgcrea.ngStrap","ngSocial","localStorage","googleAPI","sanityData"]),a.$inject=["$urlRouterProvider","$stateProvider"],angular.module("sanityApp").config(a),b.$inject=["$rootScope"],angular.module("sanityApp").run(b),c.$inject=["$scope","$rootScope","$state","googleApi"],angular.module("sanityApp").controller("StartCtrl",c),d.$inject=["$rootScope","$scope","$state","$document","sanityApp","data","videos"],angular.module("sanityApp").controller("AppRepeatCtrl",d),e.$inject=["$rootScope","$scope"],angular.module("sanityApp").controller("SettingsModalCtrl",e),f.$inject=["$rootScope","$scope"],angular.module("sanityApp").controller("FilterModalCtrl",f),g.$inject=["$scope"],angular.module("sanityApp").controller("SettingsTabsCtrl",g),h.$inject=["$scope"],angular.module("sanityApp").controller("SettingsAccordionCtrl",h),i.$inject=["$q","$rootScope"],angular.module("sanityApp").service("sanityApp",i),j.$inject=["$timeout"],angular.module("sanityApp").service("timeAgo",j),angular.module("sanityApp").filter("duration",k),angular.module("sanityApp").filter("timestamp",l),m.$inject=["$timeout","videos"],angular.module("sanityApp").directive("videoItem",m),n.$inject=["timeAgo"],angular.module("sanityApp").directive("timeAgo",n),angular.module("sanityApp").directive("selectOnClick",o)}();